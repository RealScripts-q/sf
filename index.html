<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DeppSCAPT - Your Trainable AI</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #eee;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .container {
      width: 400px;
      background: #222;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px #0ff;
      overflow-y: auto;
      max-height: 95vh;
    }

    #chatbox {
      height: 200px;
      overflow-y: auto;
      background: #333;
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 15px;
    }

    .input-section input,
    .train-section input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border: none;
      border-radius: 5px;
      background: #444;
      color: #fff;
    }

    .input-section button,
    .train-section button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      background: #0ff;
      border: none;
      border-radius: 5px;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }

    .train-section h2 {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>DeppSCAPT</h1>
    <div id="chatbox">Loading memory...</div>

    <div class="input-section">
      <input type="text" id="userInput" placeholder="Type your message...">
      <button onclick="sendMessage()">Send</button>
    </div>

    <div class="train-section">
      <h2>Train DeppSCAPT (Manual)</h2>
      <input type="text" id="newQuestion" placeholder="New question...">
      <input type="text" id="newAnswer" placeholder="New answer...">
      <button onclick="trainAI()">Train</button>

      <h2>Train from File</h2>
      <input type="file" id="fileInput" accept=".json">
      <button onclick="trainFromFile()">Upload & Train</button>
    </div>
  </div>

  <script>
    let knowledgeBase = {};

    // Load memory from external store.json
    fetch('store.json')
      .then(response => response.json())
      .then(data => {
        knowledgeBase = data;
        document.getElementById('chatbox').innerText = "Memory loaded! Ask me something.";
      })
      .catch(error => {
        document.getElementById('chatbox').innerText = "Failed to load memory.";
        console.error('Error loading store.json:', error);
      });

    function sendMessage() {
      const userInput = document.getElementById('userInput').value.trim().toLowerCase();
      if (!userInput) return;

      appendMessage("You: " + userInput);

      let response = knowledgeBase[userInput];
      if (!response) {
        response = "I don't know that yet. Train me!";
      }

      setTimeout(() => {
        appendMessage("DeppSCAPT: " + response);
      }, 500);

      document.getElementById('userInput').value = '';
    }

    function appendMessage(message) {
      const chatbox = document.getElementById('chatbox');
      const msg = document.createElement('div');
      msg.textContent = message;
      chatbox.appendChild(msg);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function trainAI() {
      const newQuestion = document.getElementById('newQuestion').value.trim().toLowerCase();
      const newAnswer = document.getElementById('newAnswer').value.trim();

      if (newQuestion && newAnswer) {
        knowledgeBase[newQuestion] = newAnswer;
        appendMessage(`Trained: "${newQuestion}" -> "${newAnswer}"`);
        document.getElementById('newQuestion').value = '';
        document.getElementById('newAnswer').value = '';
      }
    }

    function trainFromFile() {
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];

      if (!file) {
        alert("Please select a file first!");
        return;
      }

      const reader = new FileReader();
      reader.onload = function(event) {
        try {
          const newKnowledge = JSON.parse(event.target.result);

          if (typeof newKnowledge !== 'object') {
            throw new Error("File is not a valid JSON object.");
          }

          // Merge new knowledge into current knowledge
          knowledgeBase = { ...knowledgeBase, ...newKnowledge };

          appendMessage(`âœ… Trained with ${Object.keys(newKnowledge).length} new entries!`);
        } catch (error) {
          alert("Failed to read file: " + error.message);
          console.error(error);
        }
      };

      reader.readAsText(file);
    }
  </script>
</body>
</html>
